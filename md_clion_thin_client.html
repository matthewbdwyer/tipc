<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tipc: Developing on UVA hardware (CLion)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tipc
   </div>
   <div id="projectbrief">A TIP to LLVM compiler</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Developing on UVA hardware (CLion) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>You can develop <code>tipc</code> on servers hosted by the CS department (e.g., portal, granger). The file system shared by these machines includes all of the required dependencies. For a familiar IDE experience, we can leverage JetBrains support for remote development. The following instructions describe how to install and configure the JetBrains thin client for <code>tipc</code> development on UVA hosted hardware.</p>
<h1><a class="anchor" id="autotoc_md28"></a>
Configuring SSH</h1>
<p>First, let us configure password-less logins to the server. In the following instructions we will use the <a href="https://www.cs.virginia.edu/wiki/doku.php?id=compute_portal">portal cluster</a>. <br  />
</p>
<p>We will use ssh keys instead of a username/password combination. Generate an SSH key for portal connections.</p>
<div class="fragment"><div class="line">cd ~/.ssh  # Create this directory if it does not exist.</div>
<div class="line">ssh-keygen -t ed25519 -b 4096</div>
</div><!-- fragment --><p>When prompted, choose a filename for your keys and leave the passphrase field empty. <br  />
</p>
<p>Next, copy the public key you just created to the remote server. </p><div class="fragment"><div class="line">ssh-copy-id -i ~/.ssh/&lt;keyname&gt; &lt;computingID&gt;@portal.cs.virginia.edu</div>
</div><!-- fragment --><p>When prompted, provide your UVA CS password. <br  />
</p>
<p>Once complete you should be able to ssh to the portal cluster without a password. <br  />
 </p><div class="fragment"><div class="line">ssh -i ~/.ssh/&lt;keyname&gt; &lt;computingID&gt;@portal.cs.virginia.edu</div>
</div><!-- fragment --><p>You can simplify the login experience with an <a href="https://www.ssh.com/academy/ssh/config"><code>ssh</code> config file</a>. In the <code>~/.ssh</code> directory create a file named <code>config</code>, and add an entry that looks like, </p><div class="fragment"><div class="line">Host portal</div>
<div class="line">  User &lt;computingID&gt;</div>
<div class="line">  HostName portal.cs.virginia.edu</div>
<div class="line">  IdentityFile ~/.ssh/uva/&lt;keyname&gt;</div>
</div><!-- fragment --><p>Now, you can login with <code>ssh portal</code>.</p>
<h1><a class="anchor" id="autotoc_md29"></a>
Cloning tipc</h1>
<p>From <code>portal</code>, clone <code>tipc</code>.</p>
<div class="fragment"><div class="line">git clone https://github.com/matthewbdwyer/tipc.git</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md30"></a>
Configuring the Remote environment.</h1>
<p>You can configure your environment on <code>portal</code> by loading and unloading <a href="https://www.cs.virginia.edu/wiki/doku.php?id=linux_environment_modules">modules</a>. The <code>tipc</code> project includes <a href="https://modules.readthedocs.io/en/stable/modulefile.html">modulefiles</a> to help configure the environment. The modulefiles are in the <code>conf</code> directory. <br  />
</p>
<p>You can load the tipc module with the following command. </p><div class="fragment"><div class="line">module load ~/tipc/conf/modulefiles/tipc/F24</div>
</div><!-- fragment --><p>Please note that there is an assumption in the stock modulefile that <code>tipc</code> is cloned to your home directory. If that assumption does not hold true, update the <code>topdir</code> variable in <code>conf/modules/tipc/F24</code> to the actual location of the <code>tipc</code> repository. <br  />
</p>
<p>To confirm the module was successfully loaded check the value of the <code>TIPCLANG</code> environment variable. <br  />
 </p><div class="fragment"><div class="line">echo $TIPCLANG</div>
<div class="line"># /sw/ubuntu-22.04/clangllvm/17.0.6/bin/clang</div>
</div><!-- fragment --><p>To load the <code>tipc</code> environment every time you ssh to portal, add the <code>module load</code> command to your <code>bashrc</code>. </p><div class="fragment"><div class="line">echo &#39;module load ~/tipc/conf/modulefiles/tipc/F24&#39; &gt;&gt; ~/.bashrc</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md31"></a>
Building tipc from the Command Line.</h1>
<p>At this point you should be fully equipped to build tipc on portal from the command line.</p>
<p>From the <code>tipc</code> project directory, </p><div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">make -j4</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md32"></a>
Using the JetBrains thin client</h1>
<p>You may prefer to develop with an IDE. In that case you can use the <a href="https://www.jetbrains.com/help/clion/remote-development-a.html">JetBrains Gateway and thin client</a>. In this setup the IDE runs entirely on the server. You connect to the IDE from a thin client on your local machine over SSH. <br  />
</p>
<p><a href="https://www.jetbrains.com/remote-development/gateway/">JetBrains Gateway</a> can be installed as a standalone app. It also comes part of any JetBrains IDE distribution. That is, if you have CLion installed already, you need not install the gateway. The instructions will continue with the JetBrains Gateway standalone app but are nearly identical, and have been tested with CLion. <br  />
</p>
<p>First, launch the JetBrains Gateway application. From the "All Providers" page select "New Connection" under "SSH Connection".</p>
<p><img src="gateway_all_provider_new_connection.png" alt="" class="inline"/></p>
<p>From the "Connect to SSH" page, select the gear icon next to the "Connection" drop down.</p>
<p><img src="gateway_connect_ssh_connection.png" alt="" class="inline"/></p>
<p>Select the "+" icon on the "SSH Configurations" page. Fill out the information as done in the screenshot below. Note the "Host" field should match the name of the entry in your ssh config. We chose the name, "portal", in our initial setup. <br  />
</p>
<p><img src="gateway_ssh_configuration.png" alt="" class="inline"/></p>
<p>If preferred, you can prevent the connection from being dropped for inactivity. Under "Connection Parameters" check the "Send keep-alive messages..." box. <br  />
</p>
<p>Select "Test Connection" to verify you can establish a connection. <br  />
</p>
<p><img src="gateway_ssh_configuration_connection_success.png" alt="" class="inline"/></p>
<p>Select "Ok" on the "SSH Configurations" page and return to the "Connect to SSH" page. In the "Connection" drop down select the connection you just created. Select "Check Connection and Continue". <br  />
</p>
<p><img src="gateway_connect_ssh_connection_check_and_continue.png" alt="" class="inline"/></p>
<p>You will then be prompted to "Choose IDE and Project". For the "IDE version", choose "CLion". For the "Project directory" choose the <code>tipc</code> repository we previously cloned to your home directory. Select "Download IDE and Connect"</p>
<p><img src="gateway_choose_ide.png" alt="" class="inline"/></p>
<p>This process may take several minutes. Once complete, <code>tipc</code> should appear as an SSH project running on "portal". Select the project to open it.</p>
<p><img src="gateway_ssh_project.png" alt="" class="inline"/></p>
<p>The <code>tipc</code> project will open in the JetBrains client. <br  />
</p>
<p>The IDE running on portal (that you are connected to) does not source the <code>bashrc</code> file as your shell does. As such, we need to configure your build environment within CLion. <br  />
</p>
<p>From the "Project Wizard" popup accept the default toolchain by pressing "Next". <br  />
</p>
<p>Update the default CMake profile on the following page. Set the "Generator" to "Unix Makefiles", the "Build directory" to <code>build</code>, and the "Environment" to <code>LLVM_DIR=/sw/ubuntu-22.04/llvm/17.0.6/lib/cmake</code>. Select "Finish".</p>
<p><img src="client_wizard_cmake.png" alt="" class="inline"/></p>
<p>Note, if the "Project Wizard" does not appear, you can reach the same configuration page from the CLion settings. From the settings, navigate to "Build, Execution, Deployment" in the side menu, and then to "CMake". From here you can configure the default profile appropriately. <br  />
</p>
<p>Once complete, CLion will index your files and construct build configurations. <br  />
</p>
<h1><a class="anchor" id="autotoc_md33"></a>
Running tipc from CLion</h1>
<p>You should now be able to run and debug tipc with the "play" and "debug" icons respectively. <br  />
</p>
<p><img src="client_run_debug.png" alt="" class="inline"/></p>
<p>You can pass arguments to <code>tipc</code> just as you do on the command line by editing the Run/Debug configuration. <br  />
</p>
<p><img src="client_edit_conf.png" alt="" class="inline"/></p>
<p>The screenshot below shows how you can pass the <code>--help</code> flag as one of the "Program arguments". <br  />
</p>
<p><img src="client_conf_tipc_args.png" alt="" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
